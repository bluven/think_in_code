# 任务队列开发反思笔记

一开始想使用第三方，但是第三方有些缺点：

1. 参数太简单，只能传递最基本的数据类型。这就导致还是要想法子保存比较复杂的构造数据；
2. 崩溃后没有看到相应的处理。
3. 有些项目没什么人维护；

后来想自己实现一个简单的通用队列，但是参数序列化实在太困难了，一开始用的json,但是序列化出来的东西不理想（类型不对），其他的序列化工具没工夫去研究。

最后又想起用第三方队列，因为有些东西可以克服，但是参数传递还是个麻烦，最后还是要保存数据在某个地方，还是要自己反序列化，所以最终还是实现了一个简单的队列，只为volume服务，只提供最基本的那几个功能。

按照这个思路，还是花了两天，因为有些坑还是没绕过去，那就是数据库。一开始想用orm，但在网上搜了一圈，还是选择了sqlx这个最简单的工具。其中遇到的坑是映射，一直有莫名其妙的错误，好在网上同遭遇的人很多，还是解决了，中间各种郁闷，因为这种问题在其他语言其他同类工具中从不曾遇到，现在反倒有些怀念java了.

现在的队列还不完善，单元测试还没写，也不知道怎么写，开发的时候完全不想去写测试，只想赶快完善思路。不过基本功能完善了，如果一开始就走这条路就好了。

说一下教训：

1. 一开始就要弄明白自己想要什么，要解决什么问题；
2. 方案尽量选择最简单最实用的，大不了将来再扩展。
3. 用什么工具或库，文档一定要看的，直奔目标有时候也是远路；
4.　总是停下来思考，不要让方向偏了，不要过于钻牛角尖；
